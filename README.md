# `como-template`

> example / test application for the CoMo framework  
> cf. https://github.com/ircam-ismm/como

__*WARNING: The CoMo library is under heavy development*__

## Install and Luanch

```
git clone https://github.com/ircam-ismm/como-template.git my-app
cd ./my-app
npm install
npm run watch
```

## Clients 

*notes:*

  - *we assume in the description above that the application has been launched in development mode using `npm run watch`, and is thus accessible on the port `8000`*
  - *beware that using motion sensors and smartphones requires an `https` connection and most the evergreen browsers. By default, the application generates a self-signed certificate, which will cause the browser to display a warning.*


By default the template application creates 3 different clients:

  - the `player`, is the default client and is accessible at `https://your.ip:8000`, this client is dedicated at running on smartphones as it tries to access the motion sensors of the device. For development purposes it can also run on desktop, in such case it will generate random values to emulate the motion sensors (this mode is of poor help to work on and test the IML part the application).
  - the `controller`, is accessible at `https://your.ip:8000/controller`. This client is dedicated at monitoring and controlling every `player` of the application.
  - the `script-editor`, is accessible at `https://your.ip:8000/script-editor`. This client is dedicated at editing sensor data and audio processing and mappings directly in the browser. When a script is edited it is immediatly updated by every client that use it (more on that later).

## Architecture Overview

The CoMo environment is dedicated to create movement-based distributed Interactive Machine Learning (IML) applications using principaly the sensors (accelerometers and gyroscopes) of smartphones.

A given application can host multiple __projects__ that can themselves contain several __sessions__.

A __project__ (cf. `./projects` directory) is defined by several attributes:
  - Its *audio* files (cf. `./projects/[project-name]/audio`) that can be used in every __sessions__
  - Its *presets*, (cf. `./projects/[project-name]/audio`) a *preset* is mainly the description of a graph that define a CoMo *player* (warning: the  name *player* may change in the future). A graph define how different modules (e.g. data acquisition, data processing, IML components, audio chain) are instanciated and chain together. (note: the `default` preset (or a simple tweaking of the preset) is probably good enough for most of the use cases.)
  - Its *scripts*, (cf. `./projects/[project-name]/scripts`). The `scripts` are of two kinds: 
    + the `data` scripts are dedicated to apply arbitrary processing on the data acquired by the graph. The default graph uses one script to define which part of the data acquired and processed should be send the ML algorithm and to train the model.
    + the `audio` script are dedicated at defining the WebAudio graph and create the mapping betwenn the processed data, the ML output and the WebAudio nodes.
  All these scripts can be updated directly in the given files, or through the dedicated client `script-editor`.
  - Its `sessions`, (cf. `./projects/[project-name]/sessions`), is the different __sessions__ of a __project__ are stored. These files are generated by the application and should not be edited by hand (note: the data format of a session will very likely change in the future).

The source code, to be adapted to your application is located in the `./src` directory. 
  - In `./src/server` lies the server code, in most case this should not be changed.
  - In `./src/clients/[client-name]` lies the code for each clients.

## Configuring application

*note: the CoMo application make heavy use of the json5 format and library [https://www.npmjs.com/package/json5](https://www.npmjs.com/package/json5), to simplify the manual edition of configuration files.*

The `./config/como.json` allows to configure the **project** to be used when the application starts. By default, the application uses the `default` **project** (for most applications, a single project should be enough) : 

```js
// ./config/como.json
{
  project: 'default',
}
```

The `./config/como.json` allows to configure the application name et author, as well as to declare available clients :

```js
{
  // ./config/application.json
  "name": "CoMo",
  "author": "",

  "clients": {
    "player": {
      "target": "browser",
      "default": true
    },
    "controller": {
      "target": "browser",
      // "default": true
    },
    "script-editor": {
      "target": "browser",
      // "default": true
    },
  },

  "htmlTemplateDirectory": ".build/server/tmpl",
}
```

The `./config/env` directory is dedicated to put application environment configuration files (i.e. for setting port, https certificate location if any, etc.). By default, the application uses the `default` envionnement. Any number of environnment config files can be added in this directory, to tell the application to use one or the other launch the application using the `ENV` config variable when starting the application.
For exemple, given that a `./config/env/prod.json` has been declared, the application could be launched using:

```sh
sudo ENV=80 node .build/server/index.js
```

*note: setting `port: 80` (for http) or `port: 443` (for https) requires root privileges*

## Graph

@todo - include image of the graph

## License

BSD-3-Clause
